{% extends "base.html" %}
{% block content %}

<div class="product-detail-page d-flex justify-content-center align-items-center py-5 fade-in">
  <div class="card shadow-lg border-0 rounded-4 overflow-hidden" style="max-width: 720px; width: 100%;">
    
    <!-- Imagen del producto -->
    {% if producto['imagen'].startswith('http') %}
      <img src="{{ producto['imagen'] }}" class="card-img-top" alt="{{ producto['nombre'] }}"
           style="object-fit: cover; max-height: 420px;">
    {% else %}
      <img src="{{ url_for('static', filename=producto['imagen']) }}" class="card-img-top" alt="{{ producto['nombre'] }}"
           style="object-fit: cover; max-height: 420px;">
    {% endif %}

    <div class="card-body p-4">
      <!-- TÃ­tulo / artista -->
      <h2 class="card-title fw-bold mb-1 text-dark">{{ producto['nombre'] }}</h2>
      <p class="text-muted mb-3 fs-6">ðŸ‘¤ {{ producto['artista'] }}</p>

      <!-- Tipo y precio -->
      <div class="d-flex align-items-center gap-2 mb-3">
        <span class="badge bg-info text-dark text-uppercase px-3 py-2">{{ producto['tipo'] }}</span>
        <h4 class="text-success fw-bold mb-0">${{ '%.2f'|format(producto['precio']) }}</h4>
      </div>

      <!-- Disponibilidad -->
      {% if (producto['tipo'] or '')|lower == 'vinilo' %}
        <p class="mb-3">
          <strong>Stock:</strong>
          {% if (producto['stock'] or 0) > 0 %}
            <span class="text-success fw-semibold">{{ producto['stock'] }}</span>
          {% else %}
            <span class="text-danger fw-semibold">Sin stock</span>
          {% endif %}
        </p>
      {% else %}
        <p class="mb-3"><strong>Disponibilidad:</strong> Descarga digital inmediata ðŸŽ§</p>
      {% endif %}

      <!-- DescripciÃ³n -->
      {% if producto['descripcion'] %}
        <p class="mb-4 text-secondary">{{ producto['descripcion'] }}</p>
      {% endif %}

      <!-- Acciones -->
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
        <a href="{{ url_for('catalog') }}" class="btn btn-outline-dark rounded-pill px-4">
          â¬… Volver al catÃ¡logo
        </a>

        {% if session.get('usuario') %}
          {% set es_vinilo = (producto['tipo'] or '')|lower == 'vinilo' %}
          {% set sin_stock = es_vinilo and ((producto['stock'] or 0) <= 0) %}

          {% if sin_stock %}
            <button class="btn btn-secondary rounded-pill px-4" disabled>ðŸš« Sin stock</button>
          {% else %}
            <a href="{{ url_for('add_to_cart', product_id=producto['id']) }}"
               class="btn btn-success rounded-pill px-4 fw-semibold shadow-sm">
               âž• AÃ±adir al carrito
            </a>
          {% endif %}
        {% else %}
          <a href="{{ url_for('login') }}" class="btn btn-primary rounded-pill px-4">
            Inicia sesiÃ³n para comprar
          </a>
        {% endif %}
      </div>

      <!-- Proveedor -->
      {% if producto['proveedor_email'] and (producto['tipo'] or '')|lower == 'vinilo' %}
        <hr class="my-4">
        <p class="small text-muted mb-0">
          <strong>Proveedor:</strong> {{ producto['proveedor_email'] }}
        </p>
      {% endif %}
    </div>
  </div>
</div>

<!-- ðŸŒˆ AnimaciÃ³n y estilos -->
<style>
  .fade-in {
    animation: fadeIn .8s ease both;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .product-detail-page {
    min-height: 85vh;
    background: linear-gradient(135deg, #f8fafc, #eef2f7);
  }
  .card {
    transition: transform .3s ease, box-shadow .3s ease;
  }
  .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.8rem 1.5rem rgba(0,0,0,.15);
  }
</style>

{% endblock %}
