{% extends "base.html" %}
{% block content %}

<div class="cart-page container py-5 fade-in">
  <h2 class="mb-4 text-center fw-bold text-primary">ğŸ›’ Tu carrito de compras</h2>

  {% if error %}
    <div class="alert alert-danger text-center">{{ error }}</div>
  {% endif %}
  {% if request.args.get('ok') %}
    <div class="alert alert-success text-center">âœ… Â¡Pedido generado correctamente!</div>
  {% endif %}

  {% if productos %}
    <div class="table-responsive shadow-sm rounded-4 bg-white p-3 mb-4">
      <table class="table align-middle mb-0">
        <thead class="table-light">
          <tr class="text-center">
            <th>Imagen</th>
            <th>Producto</th>
            <th>Tipo</th>
            <th>Precio</th>
            <th>Cantidad</th>
            <th>Subtotal</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for p in productos %}
          <tr class="text-center align-middle">
            <td style="width: 120px;">
              {% if p['imagen'] %}
                {% if p['imagen'].startswith('http') %}
                  <img src="{{ p['imagen'] }}" alt="{{ p['nombre'] }}" class="img-fluid rounded" style="max-height: 80px;">
                {% else %}
                  <img src="{{ url_for('static', filename=p['imagen']) }}" alt="{{ p['nombre'] }}" class="img-fluid rounded" style="max-height: 80px;">
                {% endif %}
              {% else %}
                <div class="bg-light rounded p-3 text-muted small">Sin imagen</div>
              {% endif %}
            </td>
            <td>
              <a href="{{ url_for('product_detail', product_id=p['id']) }}" class="text-decoration-none fw-semibold text-dark">
                {{ p['nombre'] }}
              </a>
              <div class="text-muted small">{{ p['artista'] }}</div>
            </td>
            <td><span class="badge bg-info text-dark text-uppercase">{{ p['tipo'] }}</span></td>
            <td class="fw-bold">${{ '%.2f'|format(p['precio']) }}</td>
            <td>{{ p['cantidad'] }}</td>
            <td class="fw-bold text-success">${{ '%.2f'|format(p['subtotal']) }}</td>
            <td>
              <a href="{{ url_for('remove_from_cart', product_id=p['id']) }}" class="btn btn-sm btn-outline-danger rounded-pill">
                âŒ Quitar
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Totales -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
      <h4 class="fw-bold text-dark mb-3 mb-md-0">Total: 
        <span class="text-success">${{ '%.2f'|format(total) }}</span>
      </h4>

      <div class="d-flex gap-2">
        <a href="{{ url_for('clear_cart') }}" class="btn btn-outline-secondary rounded-pill">
          ğŸ—‘ Vaciar carrito
        </a>
        <a href="{{ url_for('pay') }}" class="btn btn-primary rounded-pill px-4 fw-semibold shadow">
  ğŸ’³ Proceder al pago
</a>

      </div>
    </div>

  {% else %}
    <div class="text-center mt-5">
      <img src="https://i.imgur.com/QGBZb8h.png" alt="Carrito vacÃ­o" class="mb-3" style="max-width: 200px;">
      <p class="lead text-muted mb-4">Tu carrito estÃ¡ vacÃ­o por ahora ğŸ˜”</p>
      <a href="{{ url_for('catalog') }}" class="btn btn-outline-primary rounded-pill px-4">
        ğŸ› Ir al catÃ¡logo
      </a>
    </div>
  {% endif %}
</div>

<!-- ğŸŒˆ Estilos y animaciÃ³n -->
<style>
  .fade-in {
    animation: fadeIn .8s ease both;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .cart-page {
    min-height: 85vh;
    background: linear-gradient(135deg, #f8fafc, #eef2f7);
  }

  table img {
    transition: transform .2s ease;
  }
  table img:hover {
    transform: scale(1.05);
  }

  .btn-outline-danger:hover {
    color: white;
    background: #dc3545;
    border-color: #dc3545;
  }
</style>

{% endblock %}
