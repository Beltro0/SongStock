{% extends "base.html" %}
{% block content %}

<div class="container py-4">
  <h2 class="mb-3">ðŸ›’ Mi Carrito</h2>

  {% if request.args.get('ok') %}
    <div class="alert alert-success">âœ… Â¡Orden creada exitosamente! Se vaciÃ³ tu carrito.</div>
  {% endif %}

  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  {% if productos and productos|length > 0 %}
    <div class="table-responsive">
      <table class="table align-middle">
        <thead class="table-light">
          <tr>
            <th>Producto</th>
            <th class="text-center">Tipo</th>
            <th class="text-center">Cant.</th>
            <th class="text-end">Precio</th>
            <th class="text-end">Subtotal</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for p in productos %}
            <tr>
              <td>{{ p.nombre }}</td>
              <td class="text-center">
                <span class="badge bg-secondary text-uppercase">{{ p.tipo }}</span>
              </td>
              <td class="text-center">{{ p.cantidad }}</td>
              <td class="text-end">${{ '%.2f'|format(p.precio) }}</td>
              <td class="text-end">${{ '%.2f'|format(p.subtotal) }}</td>
              <td class="text-center">
                <a class="btn btn-sm btn-outline-danger"
                   href="{{ url_for('remove_from_cart', product_id=p.id) }}">Eliminar</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="4" class="text-end">Total</th>
            <th class="text-end">${{ '%.2f'|format(total) }}</th>
            <th></th>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="d-flex gap-2 justify-content-end">
      <a href="{{ url_for('clear_cart') }}" class="btn btn-outline-secondary">Vaciar carrito</a>

      <form method="post" action="{{ url_for('checkout') }}">
        <button class="btn btn-primary">Proceder a pagar</button>
      </form>
    </div>
  {% else %}
    <div class="alert alert-info">Tu carrito estÃ¡ vacÃ­o.</div>
    <a href="{{ url_for('catalog') }}" class="btn btn-dark">â¬… Seguir comprando</a>
  {% endif %}
</div>

{% endblock %}
