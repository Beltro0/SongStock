{% extends "base.html" %}
{% block content %}
<div class="catalog-page container py-4">
  <h2 class="mb-4 text-center fw-bold text-primary">ðŸŽ¶ CatÃ¡logo de Productos</h2>

  <!-- ðŸ”Ž Barra de bÃºsqueda y filtro -->
  <form method="GET" action="{{ url_for('catalog') }}" class="row g-3 mb-4 justify-content-center">
    <div class="col-md-5">
      <input type="text" name="q" class="form-control rounded-pill shadow-sm"
             placeholder="Buscar por nombre o artista..." value="{{ q }}">
    </div>
    <div class="col-md-3">
      <select name="tipo" class="form-select rounded-pill shadow-sm">
        <option value="">Todos los formatos</option>
        <option value="mp3" {% if tipo == "mp3" %}selected{% endif %}>MP3</option>
        <option value="vinilo" {% if tipo == "vinilo" %}selected{% endif %}>Vinilo</option>
      </select>
    </div>
    <div class="col-md-2 d-grid">
      <button type="submit" class="btn btn-primary rounded-pill fw-bold shadow">Buscar</button>
    </div>
  </form>

  <!-- ðŸ›’ Grid de productos -->
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
    {% for p in productos %}
      <div class="col fade-in">
        <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden position-relative hover-scale">

          <!-- Imagen del producto (acepta URLs o archivos locales) -->
          <a href="{{ url_for('product_detail', product_id=p['id']) }}">
            {% if p['imagen'].startswith('http') %}
              <img src="{{ p['imagen'] }}" class="card-img-top" alt="{{ p['nombre'] }}">
            {% else %}
              <img src="{{ url_for('static', filename=p['imagen']) }}" class="card-img-top" alt="{{ p['nombre'] }}">
            {% endif %}
          </a>

          <div class="card-body d-flex flex-column p-3">
            <h5 class="card-title fw-semibold mb-1 text-dark">
              <a href="{{ url_for('product_detail', product_id=p['id']) }}" class="text-decoration-none text-dark">
                {{ p['nombre'] }}
              </a>
            </h5>
            <p class="text-muted small mb-1">ðŸ‘¤ {{ p['artista'] }}</p>
            <p class="fw-bold text-success fs-5 mb-1">${{ '%.2f'|format(p['precio']) }}</p>
            <p><span class="badge bg-info text-dark text-uppercase">{{ p['tipo'] }}</span></p>

            {% if session.get('usuario') %}
              <a href="{{ url_for('add_to_cart', product_id=p['id']) }}"
                 class="btn btn-success mt-auto rounded-pill shadow-sm fw-semibold">
                 âž• AÃ±adir al carrito
              </a>
            {% else %}
              <p class="text-center mt-auto text-secondary small fst-italic">Inicia sesiÃ³n para comprar</p>
            {% endif %}
          </div>
        </div>
      </div>
    {% else %}
      <div class="col-12 text-center">
        <div class="alert alert-warning">ðŸ˜• No se encontraron productos con esos criterios.</div>
      </div>
    {% endfor %}
  </div>
</div>

<!-- ðŸŒˆ Estilos locales -->
<style>
  .hover-scale {
    transition: transform .25s ease, box-shadow .25s ease;
  }
  .hover-scale:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,.15);
  }
  .fade-in {
    animation: fadeIn 0.8s ease both;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
{% endblock %}
