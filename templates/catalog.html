{% extends "base.html" %}
{% block content %}
<div class="catalog-page">
  <h2 class="mb-4 text-center">ðŸŽ¶ CatÃ¡logo de Productos</h2>

  <!-- ðŸ”Ž Barra de bÃºsqueda y filtro -->
  <form method="GET" action="{{ url_for('catalog') }}" class="row g-3 mb-4 justify-content-center">
    <div class="col-md-5">
      <input type="text" name="q" class="form-control rounded-pill"
             placeholder="Buscar por nombre o artista..." value="{{ q }}">
    </div>
    <div class="col-md-3">
      <select name="tipo" class="form-select rounded-pill">
        <option value="">Todos los formatos</option>
        <option value="mp3" {% if tipo == "mp3" %}selected{% endif %}>MP3</option>
        <option value="vinilo" {% if tipo == "vinilo" %}selected{% endif %}>Vinilo</option>
      </select>
    </div>
    <div class="col-md-2 d-grid">
      <button type="submit" class="btn btn-primary rounded-pill fw-bold">Buscar</button>
    </div>
  </form>

  <!-- ðŸ›’ Grid de productos -->
  <div class="row row-cols-1 row-cols-md-4 g-4">
    {% for p in productos %}
      <div class="col">
        <div class="card h-100 shadow-sm border-0">
          <!-- ðŸ”— Imagen clickeable -->
          <a href="{{ url_for('product_detail', product_id=p['id']) }}">
            <img src="{{ url_for('static', filename=p['imagen']) }}" class="card-img-top" alt="{{ p['nombre'] }}">
          </a>
          <div class="card-body d-flex flex-column">
            <!-- ðŸ”— TÃ­tulo clickeable -->
            <h5 class="card-title">
              <a href="{{ url_for('product_detail', product_id=p['id']) }}" class="product-link">
                {{ p['nombre'] }}
              </a>
            </h5>
            <p class="text-muted">ðŸ‘¤ {{ p['artista'] }}</p>
            <p class="fw-bold text-success fs-5">${{ '%.2f'|format(p['precio']) }}</p>
            <p><span class="badge bg-info text-dark">{{ p['tipo'] }}</span></p>
            {% if session.get('usuario') %}
              <a href="{{ url_for('add_to_cart', product_id=p['id']) }}" class="btn btn-success mt-auto rounded-pill">âž• AÃ±adir al carrito</a>
            {% endif %}
          </div>
        </div>
      </div>
    {% else %}
      <div class="col-12 text-center">
        <div class="alert alert-warning">ðŸ˜• No se encontraron productos con esos criterios.</div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
